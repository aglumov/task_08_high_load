# Задание
Реализация GFS2 хранилища на виртуалках

# Подготовка
1. Требуется коллекция ansible: community.general >= 7.3.0
2. В каталоге ansible создать файл ```aws_credentials.conf``` с параметрами доступа к API облака Крок:
```
[default]
aws_access_key_id = <access key>
aws_secret_access_key = <secret key>
```
3. В каталоге terraform создать файл ```cc.auto.tfvars``` с параметрами доступа к API облака Крок:
```
cc_access_key = "<access key>"
cc_secret_key = "<secret key>"
```
# Запуск
```terraform apply```

Дождаться запуска вм.

```ansible-playbook setup.yaml```

# Пояснения

При помощи terraform создаются 6 вм: 2 балансировщика (lb0-1), 2 backend (app0-1), 1 db (db0), 1 iscsi-target. В манифесте main.tf также прописано создание сетевых интерфейсов (aws_network_interface) и дополнительного диска для iscsi-target. В network.tf на интерфейсы добавляется security group для удобства подключения.

На балансировщиках настроен keepalived, который при становлении мастером через API облака назначает заданный публичный ip на свою вм. Таким образом, обеспечивается отказоустойчивость балансировщиков. Дополнительно задан скрипт проверки работоспособности nginx. В nginx настроено проксирование на backend сервера. Также конфигурируются параметры sysctl для работы с высокими нагрузками.

На backend серверах настроен кластер pacemaker аналогично заданию 7. К iscsi-target подключен дополнительный диск, который подключается к backend серверам по iscsi. Настроен кластерный LVM, раздел отформатирован в GFS2 и смонтирован в /var/www/wordpress. В качестве backend приложения выбран WordPress.

На db сервере установлена некластеризованная база данных MariaDB.
